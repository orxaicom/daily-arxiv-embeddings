name: Calculate The Embeddings

on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  run-bash-script:
    runs-on: ubuntu-latest

    env:
      KAGGLE_USERNAME: ${{ secrets.KAGGLE_U }}
      KAGGLE_KEY: ${{ secrets.KAGGLE_K }}

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up permissions for the script
      run: chmod +x ./kaggle/daily.sh

    - name: Execute the bash script
      run: ./kaggle/daily.sh

    - name: Trigger External Workflow
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const response = await octokit.request('POST /repos/:owner/:repo/dispatches', {
            owner: 'orxaicom',
            repo: 'arxiv-radar',
            event_type: 'trigger-external-event',
          });
          console.log(response.data);
